import{r as c,T as d,j as a,L as S,a as P}from"./index-COgq7w1N.js";import{n as B,o as E,a as L,p as T,i as C,e as k,g as F,f as R}from"./firestore-DFEv3qpL.js";const V={async addVacina(e){try{const s={...e,dataAplicacao:e.dataAplicacao instanceof Date?e.dataAplicacao:new Date(e.dataAplicacao),dataProxima:e.dataProxima?e.dataProxima instanceof Date?e.dataProxima:new Date(e.dataProxima):void 0};return await T(s)}catch(s){throw console.error("Erro ao adicionar vacina:",s),s}},async getTodasVacinas(){try{return await L()}catch(e){throw console.error("Erro ao buscar todas as vacinas:",e),e}},async getVacinasPorBrinco(e){try{return await E(e)}catch(s){throw console.error("Erro ao buscar vacinas por brinco:",s),s}},async getVacinasBrutasPorBrinco(e){try{return await B(e)}catch(s){throw console.error("Erro ao buscar vacinas brutas:",s),s}}},z={async addAnimal(e){try{return await R(e)}catch(s){throw console.error("Erro ao adicionar animal:",s),s}},async getAnimais(){try{return await F()}catch(e){throw console.error("Erro ao buscar animais:",e),e}},async updateAnimal(e,s){try{await k(e,s)}catch(n){throw console.error("Erro ao atualizar animal:",n),n}},async deleteAnimal(e){try{await C(e)}catch(s){throw console.error("Erro ao deletar animal:",s),s}}};function f(e){if(!e)return"vencida";const s=new Date,l=((e instanceof d?e.toDate():e).getTime()-s.getTime())/(1e3*60*60*24);return l<0?"vencida":l<=15?"proxima":"em-dia"}function H(){const[e,s]=c.useState([]),[n,l]=c.useState([]),[m,j]=c.useState(""),[x,w]=c.useState("todos"),[v,y]=c.useState(!0);c.useEffect(()=>{A()},[]);async function A(){try{y(!0);const[t,r]=await Promise.all([z.getAnimais(),V.getTodasVacinas()]);l(t),s(r)}catch(t){console.error("Erro ao carregar dados:",t)}finally{y(!1)}}const p=n.map(t=>{const r=e.filter(i=>String(i.animalBrinco)===String(t.numeroBrinco));if(r.length===0)return null;const o=r.sort((i,g)=>{const D=i.dataAplicacao instanceof d?i.dataAplicacao.toDate():new Date(i.dataAplicacao);return(g.dataAplicacao instanceof d?g.dataAplicacao.toDate():new Date(g.dataAplicacao)).getTime()-D.getTime()})[0];return{animal:t,ultimaVacina:o}}).filter(t=>t!==null),N=p.filter(t=>{const r=(t==null?void 0:t.animal.numeroBrinco.toString().includes(m))||((t==null?void 0:t.animal.raca)||"").toLowerCase().includes(m.toLowerCase());let o=!0;return x!=="todos"&&(t!=null&&t.ultimaVacina?o=f(t==null?void 0:t.ultimaVacina.dataProxima)===x:o=x==="vencida"),r&&o}),h=p.length,u=p.filter(t=>t.ultimaVacina).length,b=h>0?Math.round(u/h*100):0;return a.jsx("div",{children:v?a.jsx(S,{}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Controle de Vacinas"}),a.jsxs("div",{className:"mt-2 flex flex-col sm:flex-row gap-4",children:[a.jsxs("div",{children:[a.jsx("span",{className:"block text-sm text-gray-700",children:"Percentual vacinado"}),a.jsxs("span",{className:"text-2xl font-bold text-primary-600",children:[b,"%"]})]}),a.jsxs("div",{children:[a.jsx("span",{className:"block text-sm text-gray-700",children:"Animais vacinados"}),a.jsx("span",{className:"text-lg font-medium text-green-700",children:u})]}),a.jsxs("div",{children:[a.jsx("span",{className:"block text-sm text-gray-700",children:"Não vacinados"}),a.jsx("span",{className:"text-lg font-medium text-red-700",children:h-u})]})]})]}),a.jsxs("div",{className:"mb-4 flex flex-col sm:flex-row gap-2 items-end",children:[a.jsx("input",{type:"text",value:m,onChange:t=>j(t.target.value),className:"px-3 py-2 border border-gray-300 rounded-md shadow-sm text-sm",placeholder:"Buscar por brinco"}),a.jsxs("select",{value:x,onChange:t=>w(t.target.value),className:"px-3 py-2 border border-gray-300 rounded-md shadow-sm text-sm",children:[a.jsx("option",{value:"todos",children:"Todos"}),a.jsx("option",{value:"em-dia",children:"Em dia"}),a.jsx("option",{value:"proxima",children:"Próxima"}),a.jsx("option",{value:"vencida",children:"Vencida"})]}),a.jsx(P,{to:"/vacinas/nova",className:"ml-auto px-4 py-2 bg-primary-600 text-white rounded hover:bg-primary-700 text-sm",children:"Registrar Vacina"})]}),a.jsx("div",{className:"bg-white shadow rounded-lg overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Brinco"}),a.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Animal"}),a.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Última Vacina"}),a.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Tipo"}),a.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Próxima"}),a.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"})]})}),a.jsx("tbody",{className:"divide-y divide-gray-100",children:N.map(({animal:t,ultimaVacina:r})=>{if(!t||!r)return null;const o=f(r==null?void 0:r.dataProxima);return a.jsxs("tr",{className:o==="vencida"?"bg-red-50":o==="proxima"?"bg-yellow-50":"",children:[a.jsx("td",{className:"px-4 py-2 font-mono",children:t.numeroBrinco}),a.jsx("td",{className:"px-4 py-2",children:t.raca}),a.jsx("td",{className:"px-4 py-2",children:r?r.dataAplicacao instanceof d?r.dataAplicacao.toDate().toLocaleDateString():r.dataAplicacao instanceof Date?r.dataAplicacao.toLocaleDateString():new Date(r.dataAplicacao).toLocaleDateString():"-"}),a.jsx("td",{className:"px-4 py-2",children:r?r.nome:"-"}),a.jsx("td",{className:"px-4 py-2",children:r?r.dataProxima instanceof d?r.dataProxima.toDate().toLocaleDateString():r.dataProxima instanceof Date?r.dataProxima.toLocaleDateString():new Date(r.dataProxima).toLocaleDateString():"-"}),a.jsxs("td",{className:"px-4 py-2",children:[o==="em-dia"&&a.jsx("span",{className:"px-2 py-1 rounded bg-green-100 text-green-800 text-xs",children:"Em dia"}),o==="proxima"&&a.jsx("span",{className:"px-2 py-1 rounded bg-yellow-100 text-yellow-800 text-xs",children:"Próxima"}),o==="vencida"&&a.jsx("span",{className:"px-2 py-1 rounded bg-red-100 text-red-800 text-xs",children:"Vencida"})]})]},t.id)})})]})})]})})}export{H as default};
