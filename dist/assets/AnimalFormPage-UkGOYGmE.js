import{r as d,j as e,T as N,f as w,e as E}from"./index-COgq7w1N.js";import{A as h,d as S,e as k,f as A}from"./firestore-DFEv3qpL.js";const j=o=>o instanceof Date&&!isNaN(o.getTime()),v=o=>!o||!j(o)?"":o.toISOString().split("T")[0],C=[{id:"amarelo",nome:"Amarelo",cor:"bg-yellow-400"},{id:"verde",nome:"Verde",cor:"bg-green-500"},{id:"azul",nome:"Azul",cor:"bg-blue-500"},{id:"vermelho",nome:"Vermelho",cor:"bg-red-500"}],B=({onSubmit:o,onCancel:g,initialData:s})=>{const[x,c]=d.useState(!1),[f,i]=d.useState(null),[t,n]=d.useState({numeroBrinco:"",corBrinco:"amarelo",dataEntrada:new Date,dataNascimento:void 0,raca:"",sexo:void 0,status:h.ATIVO,observacoes:"",foto:void 0});d.useEffect(()=>{if(s){const a=r=>{if(r instanceof Date)return r;if(r instanceof N)return r.toDate();const u=new Date(r);return j(u)?u:void 0};n({numeroBrinco:String(s.numeroBrinco||""),corBrinco:s.corBrinco,dataEntrada:a(s.dataEntrada)||new Date,dataNascimento:s.dataNascimento?a(s.dataNascimento):void 0,raca:s.raca,sexo:s.sexo,status:s.status,observacoes:s.observacoes||"",foto:s.foto})}},[s]);const m=async a=>{a.preventDefault(),c(!0),i(null);try{await o(t)}catch(r){i(r instanceof Error?r.message:"Erro ao salvar animal")}finally{c(!1)}},l=async a=>{var u;const r=(u=a.target.files)==null?void 0:u[0];if(r)try{c(!0);const b=new FileReader;b.onloadend=()=>{const y=b.result;n(p=>({...p,foto:y}))},b.readAsDataURL(r)}catch{i("Erro ao converter a imagem")}finally{c(!1)}};return e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[f&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:f}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Número do Brinco"}),e.jsx("input",{type:"text",value:t.numeroBrinco,onChange:a=>n(r=>({...r,numeroBrinco:a.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Cor do Brinco"}),e.jsx("select",{value:t.corBrinco,onChange:a=>n(r=>({...r,corBrinco:a.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0,children:C.map(a=>e.jsx("option",{value:a.id,children:a.nome},a.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Data de Entrada"}),e.jsx("input",{type:"date",value:v(t.dataEntrada),onChange:a=>n(r=>({...r,dataEntrada:new Date(a.target.value)})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Data de Nascimento"}),e.jsx("input",{type:"date",value:v(t.dataNascimento),onChange:a=>n(r=>({...r,dataNascimento:new Date(a.target.value)})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Raça"}),e.jsx("input",{type:"text",value:t.raca,onChange:a=>n(r=>({...r,raca:a.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Sexo"}),e.jsxs("select",{value:t.sexo||"",onChange:a=>n(r=>({...r,sexo:a.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"M",children:"Macho"}),e.jsx("option",{value:"F",children:"Fêmea"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Status"}),e.jsx("select",{value:t.status,onChange:a=>n(r=>({...r,status:a.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0,children:Object.values(h).map(a=>e.jsx("option",{value:a,children:a.charAt(0).toUpperCase()+a.slice(1)},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Foto"}),e.jsx("input",{type:"file",accept:"image/*",onChange:l,className:"mt-1 block w-full"}),t.foto&&e.jsx("img",{src:t.foto,alt:"Preview",className:"mt-2 max-h-48 rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Observações"}),e.jsx("textarea",{value:t.observacoes,onChange:a=>n(r=>({...r,observacoes:a.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",rows:3})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{type:"button",onClick:g,className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:x,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700",children:x?"Salvando...":"Salvar"})]})]})};function q(){const{id:o}=w(),g=E(),[s,x]=d.useState(null),[c,f]=d.useState(!0),[i,t]=d.useState(null);d.useEffect(()=>{async function m(){if(o)try{console.log("Carregando animal:",o);const l=await S(o);console.log("Animal carregado:",l),x(l)}catch(l){console.error("Erro ao carregar animal:",l),t("Erro ao carregar animal")}f(!1)}m()},[o]);const n=async m=>{try{o?await k(o,m):await A(m),g("/animais")}catch(l){console.error("Erro ao salvar animal:",l),t("Erro ao salvar animal")}};return e.jsxs(e.Fragment,{children:[c&&e.jsx("div",{className:"p-4",children:"Carregando..."}),i&&e.jsxs("div",{className:"p-4",children:["Erro: ",i]}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:o?"Editar Animal":"Novo Animal"}),e.jsx(B,{onSubmit:n,onCancel:()=>g("/animais"),initialData:s||void 0})]})]})}export{q as AnimalFormPage};
