import{e as w,f as N,u as F,r as i,j as m,T as P}from"./index-COgq7w1N.js";import{I as b}from"./IncidentForm-OPZ5o20Q.js";import{I as T,j as R,g,k as C}from"./firestore-DFEv3qpL.js";function U(){const p=w(),{id:c}=N(),[h]=F(),d=h.get("animalId"),[D,o]=i.useState(!1),[I,r]=i.useState(""),[f,y]=i.useState(null),[u,l]=i.useState(null),[S,x]=i.useState([]),[e,E]=i.useState({tipo:R.DOENCA,descricao:"",data:new Date,status:T.PENDENTE});i.useEffect(()=>{async function t(){try{o(!0);const a=await g();if(x(a),d){const n=a.find(s=>s.id===d);n?(l(n),E(s=>({...s,animalId:n.id}))):r("Animal não encontrado")}}catch(a){console.error("Erro ao carregar dados:",a),r("Erro ao carregar animais")}finally{o(!1)}}c||t()},[c,d]);async function A(){try{o(!0);const a=(await g()).find(n=>n.id===e.animalId);a?l(a):r("Animal não encontrado")}catch(t){console.error("Erro ao carregar animal:",t),r("Erro ao carregar dados do animal")}finally{o(!1)}}function j(t){var n;const a=(n=t.target.files)==null?void 0:n[0];if(a){const s=new FileReader;s.onloadend=()=>{y(s.result)},s.readAsDataURL(a)}}async function v(t){if(t.preventDefault(),r(""),!u&&!e.animalId){r("Selecione um animal");return}try{o(!0);const a=e.data instanceof P?e.data.toDate():e.data instanceof Date?e.data:new Date;await C({...e,data:a,foto:f}),p("/incidentes")}catch(a){console.error("Erro ao salvar incidente:",a),r("Erro ao salvar dados do incidente")}finally{o(!1)}}return D?m.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:m.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):m.jsx(b,{incidente:e,setIncidente:E,animais:S,animal:u,setAnimal:l,erro:I,isEdit:!!c,foto:f,handleFotoChange:j,handleSubmit:v,loadAnimal:A})}export{U as default};
