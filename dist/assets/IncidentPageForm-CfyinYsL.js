import{e as w,f as N,u as F,r as t,j as l,T as P}from"./index-COgq7w1N.js";import{I as b}from"./IncidentForm-OPZ5o20Q.js";import{I as T,j as R,g,k as C}from"./firestore-DFEv3qpL.js";function U(){const I=w(),{id:o}=N(),[h]=F(),c=h.get("animalId"),[D,r]=t.useState(!1),[S,i]=t.useState(""),[m,x]=t.useState(null),[u,f]=t.useState(null),[y,j]=t.useState([]),[e,p]=t.useState({tipo:R.DOENCA,descricao:"",data:new Date,status:T.PENDENTE});t.useEffect(()=>{o||(c?E():g().then(j))},[o,c]);async function E(){try{r(!0);const a=(await g()).find(s=>s.id===c);a?(f(a),p(s=>({...s,animalId:a.id}))):i("Animal nÃ£o encontrado")}catch(n){console.error("Erro ao carregar animal:",n),i("Erro ao carregar dados do animal")}finally{r(!1)}}function v(n){var s;const a=(s=n.target.files)==null?void 0:s[0];if(a){const d=new FileReader;d.onloadend=()=>{x(d.result)},d.readAsDataURL(a)}}async function A(n){if(n.preventDefault(),i(""),!u&&!e.animalId){i("Selecione um animal");return}try{r(!0);const a=e.data instanceof P?e.data.toDate():e.data instanceof Date?e.data:new Date;await C({...e,data:a,foto:m}),I("/incidentes")}catch(a){console.error("Erro ao salvar incidente:",a),i("Erro ao salvar dados do incidente")}finally{r(!1)}}return D?l.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):l.jsx(b,{incidente:e,setIncidente:p,animais:y,animal:u,setAnimal:f,erro:S,isEdit:!!o,foto:m,handleFotoChange:v,handleSubmit:A,loadAnimal:E})}export{U as default};
